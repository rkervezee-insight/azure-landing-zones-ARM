{
    "handler": "Microsoft.Azure.CreateUIDef",
    "version": "0.1.2-preview",
    "parameters": {
        "basics": [
            {}
        ],
        "steps": [
            {
                "name": "esNaming",
                "label": "Naming Convention Prefixes",
                "subLabel": {
                    "preValidation": "Provide values for all Azure resources that will be created.",
                    "postValidation": "Done"
                },
                "bladeTitle": "Naming Convention Prefixes",
                "elements": [
                    {
                        "name": "infoBox1",
                        "type": "Microsoft.Common.InfoBox",
                        "visible": true,
                        "options": {
                            "icon": "Info",
                            "text": "Tenant level deployments require access at the tenant root (/) scope. Visit this link to ensure you have the appropriate RBAC permission to complete the deployment",
                            "uri": "https://docs.microsoft.com/azure/role-based-access-control/elevate-access-global-admin"
                        }
                    },
                    {
                        "name": "textBlock0",
                        "type": "Microsoft.Common.TextBlock",
                        "visible": true,
                        "options": {
                            "text": "THe deployment will create the management group hierarchy under the Tenant Root Group with the prefix provided at this step.",
                            "link": {
                                "label": "Learn more",
                                "uri": "https://docs.microsoft.com/azure/cloud-adoption-framework/ready/enterprise-scale/management-group-and-subscription-organization"
                            }
                        }
                    },
                    {
                        "name": "esComIdentifier",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Company Identifier Prefix",
                        "toolTip": "Provide a value for the company identifier, 1-5 characters.",
                        "defaultValue": "stt",
                        "constraints": {
                            "required": true,
                            "regex": "^[a-z0-9A-Z-]{1,5}$",
                            "validationMessage": "The prefix must be 1-5 characters."
                        }
                    },
                    {
                        "name": "esLocIdentifier",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Location Identifier Prefix",
                        "toolTip": "Provide a value for the location identifier, 3 characters (Australia East - SYD) or (Australia SouthEast - MEL)",
                        "defaultValue": "syd",
                        "constraints": {
                            "required": true,
                            "regex": "^[a-z0-9A-Z-]{3}$",
                            "validationMessage": "The prefix must be 3 characters."
                        }
                    },
                    {
                        "name": "esSubIdentifier",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Subscription Identifier Prefix",
                        "toolTip": "Provide a value for the subscription identifier, 3 characters eg 'cor'.",
                        "defaultValue": "cor",
                        "constraints": {
                            "required": true,
                            "regex": "^[a-z0-9A-Z-]{3}$",
                            "validationMessage": "The prefix must be 3 characters."
                        }
                    },
                    {
                        "name": "text2",
                        "type": "Microsoft.Common.TextBlock",
                        "visible": true,
                        "options": {
                            "text": "Please provide Azure resource naming values:"
                        }
                    },
                    {
                        "name": "esArgIdentifier",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Resource Group Identifier",
                        "toolTip": "Provide a value for the Resource Group identifier",
                        "defaultValue": "arg",
                        "constraints": {
                            "required": true,
                            "regex": "^[a-z0-9A-Z-]{3}$",
                            "validationMessage": "The prefix must be 3 characters."
                        }
                    },
                    {
                        "name": "esOmsIdentifier",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Log Analytics Identifier",
                        "toolTip": "Provide a naming prefix for the Log Analytics workspace identifier",
                        "defaultValue": "oms",
                        "constraints": {
                            "required": true,
                            "regex": "^[a-z0-9A-Z-]{3}$",
                            "validationMessage": "The prefix must be 3 characters."
                        }
                    },
                    {
                        "name": "esVngIdentifier",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Virtual Network Gateway Identifier",
                        "toolTip": "Provide a naming prefix for the Virtual Network Gateway identifier",
                        "defaultValue": "vng",
                        "constraints": {
                            "required": true,
                            "regex": "^[a-z0-9A-Z-]{3}$",
                            "validationMessage": "The prefix must be 3 characters."
                        }
                    },
                    {
                        "name": "esVntIdentifier",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Virtual Network Identifier",
                        "toolTip": "Provide a value for the Virtual Network identifier",
                        "defaultValue": "vnt",
                        "constraints": {
                            "required": true,
                            "regex": "^[a-z0-9A-Z-]{3}$",
                            "validationMessage": "The prefix must be 3 characters."
                        }
                    },
                    {
                        "name": "esPipIdentifier",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Public IP Identifier",
                        "toolTip": "Provide a naming prefix for the Public IP identifier",
                        "defaultValue": "pip",
                        "constraints": {
                            "required": true,
                            "regex": "^[a-z0-9A-Z-]{3}$",
                            "validationMessage": "The prefix must be 3 characters."
                        }
                    },
                    {
                        "name": "esAfwIdentifier",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Azure Firewall Identifier",
                        "toolTip": "Provide a naming prefix for the Azure Firewall identifier",
                        "defaultValue": "afw",
                        "constraints": {
                            "required": true,
                            "regex": "^[a-z0-9A-Z-]{3}$",
                            "validationMessage": "The prefix must be 3 characters."
                        }
                    },
                    {
                        "name": "esAaaIdentifier",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Azure Automation Identifier",
                        "toolTip": "Provide a naming prefix for the Azure Automation identifier",
                        "defaultValue": "aaa",
                        "constraints": {
                            "required": true,
                            "regex": "^[a-z0-9A-Z-]{3}$",
                            "validationMessage": "The prefix must be 3 characters."
                        }
                    },
                    {
                        "name": "esStaIdentifier",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Storage Identifier",
                        "toolTip": "Provide a value for the Storage identifier",
                        "defaultValue": "sta",
                        "constraints": {
                            "required": true,
                            "regex": "^[a-z0-9A-Z-]{3}$",
                            "validationMessage": "The prefix must be 3 characters."
                        }
                    },
                    {
                        "name": "esUdrIdentifier",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Route Table Identifier",
                        "toolTip": "Provide a value for the Route Table identifier",
                        "defaultValue": "udr",
                        "constraints": {
                            "required": true,
                            "regex": "^[a-z0-9A-Z-]{3}$",
                            "validationMessage": "The prefix must be 3 characters."
                        }
                    },
                    {
                        "name": "esNsgIdentifier",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Network Security Group Identifier",
                        "toolTip": "Provide a value for the Network Security Group identifier",
                        "defaultValue": "nsg",
                        "constraints": {
                            "required": true,
                            "regex": "^[a-z0-9A-Z-]{3}$",
                            "validationMessage": "The prefix must be 3 characters."
                        }
                    },
                    {
                        "name": "esAkvIdentifier",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Azure Key Vault Identifier",
                        "toolTip": "Provide a value for the Azure Key Vault Identifier",
                        "defaultValue": "akv",
                        "constraints": {
                            "required": true,
                            "regex": "^[a-z0-9A-Z-]{3}$",
                            "validationMessage": "The prefix must be 3 characters."
                        }
                    },
                    {
                        "name": "esVngIdentifier",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Virtual Network Gateway Identifier",
                        "toolTip": "Provide a naming prefix for the Virtual Network Gateway identifier",
                        "defaultValue": "vng",
                        "constraints": {
                            "required": true,
                            "regex": "^[a-z0-9A-Z-]{3}$",
                            "validationMessage": "The prefix must be 3 characters."
                        }
                    },
                    {
                        "name": "esAfwIdentifier",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Azure Firewall Identifier",
                        "toolTip": "Provide a naming prefix for the Azure Firewall identifier",
                        "defaultValue": "afw",
                        "constraints": {
                            "required": true,
                            "regex": "^[a-z0-9A-Z-]{3}$",
                            "validationMessage": "The prefix must be 3 characters."
                        }
                    },
                    {
                        "name": "esWanIdentifier",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Azure Virtual WAN Identifier",
                        "toolTip": "Provide a naming prefix for the Azure vWAN identifier",
                        "defaultValue": "wan",
                        "constraints": {
                            "required": true,
                            "regex": "^[a-z0-9A-Z-]{3}$",
                            "validationMessage": "The prefix must be 3 characters."
                        }
                    },
                    {
                        "name": "esHubIdentifier",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Azure Virtual Hub Identifier",
                        "toolTip": "Provide a naming prefix for the Azure vHub identifier",
                        "defaultValue": "hub",
                        "constraints": {
                            "required": true,
                            "regex": "^[a-z0-9A-Z-]{3}$",
                            "validationMessage": "The prefix must be 3 characters."
                        }
                    },
                    {
                        "name": "esRsvIdentifier",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Recovery Services Vaults Identifier",
                        "toolTip": "Provide a value for the Recovery Services Vaults Identifier",
                        "defaultValue": "rsv",
                        "constraints": {
                            "required": true,
                            "regex": "^[a-z0-9A-Z-]{3}$",
                            "validationMessage": "The prefix must be 3 characters."
                        }
                    },
                    {
                        "name": "text3",
                        "type": "Microsoft.Common.TextBlock",
                        "visible": true,
                        "options": {
                            "text": "Please provide values for the Landing Zone tags:"
                        }
                    },
                    {
                        "name": "esSubscriptionTag",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Subscription Tag",
                        "toolTip": "Provide a value for the subscription tag",
                        "defaultValue": "platform",
                        "constraints": {
                            "required": false
                        }
                    },
                    {
                        "name": "esOwnerTag",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Owner Tag",
                        "toolTip": "Provide a value for the owner tag",
                        "defaultValue": "tulpy",
                        "constraints": {
                            "required": false
                        }
                    },
                    {
                        "name": "esCostCenterTag",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Cost Center Tag",
                        "toolTip": "Provide a value for the cost center tag",
                        "defaultValue": "1234",
                        "constraints": {
                            "required": false
                        }
                    }
                ]
            },
            {
                "name": "esPlatformManagement",
                "label": "Platform management, security, and governance",
                "subLabel": {
                    "preValidation": "",
                    "postValidation": ""
                },
                "bladeTitle": "lzGs",
                "elements": [
                    {
                        "name": "infoBox1",
                        "type": "Microsoft.Common.InfoBox",
                        "visible": true,
                        "options": {
                            "icon": "Info",
                            "text": "To enable the Platform Azure subscription, you must choose an existing Azure subscription. Please note, this subscription will be moved to the Platform Management Group and Platform resources will be deployed.",
                            "uri": "https://github.com/Azure/Enterprise-Scale/blob/main/docs/reference/Readme.md"
                        }
                    },
                    {
                        "name": "esLogAnalytics",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Deploy Log Analytics workspace and enable monitoring for your platform and resources",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected when also adding a subscription for management, ARM will deploy resources and enable them for continious compliance.",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
                        "visible": true
                    },
                    {
                        "name": "esLogRetention",
                        "type": "Microsoft.Common.Slider",
                        "min": 30,
                        "max": 730,
                        "label": "Log Analytics Data Retention (days)",
                        "subLabel": "Days",
                        "defaultValue": 30,
                        "showStepMarkers": false,
                        "toolTip": "Select retention days for Azure logs. Default is 30 days.",
                        "constraints": {
                            "required": false
                        },
                        "visible": "[equals(steps('esPlatformManagement').esLogAnalytics, 'Yes')]"
                    },           
                    {
                        "name": "mgmtSubApi",
                        "type": "Microsoft.Solutions.ArmApiControl",
                        "request": {
                            "method": "GET",
                            "path": "subscriptions?api-version=2020-01-01"
                        }
                    },
                    {
                        "name": "tenantApi",
                        "type": "Microsoft.Solutions.ArmApiControl",
                        "request": {
                            "method": "GET",
                            "path": "tenants?api-version=2020-01-01"
                        }
                    },
                    {
                        "name": "esAzureAdTenant",
                        "type": "Microsoft.Common.DropDown",
                        "label": "Azure AD Tenant (required)",
                        "toolTip": "",
                        "multiselect": false,
                        "selectAll": true,
                        "filter": true,
                        "filterPlaceholder": "Filter items ...",
                        "multiLine": true,
                        "visible": true,
                        "constraints": {
                            "allowedValues": "[map(steps('esPlatformManagement').tenantApi.value, (tenant) => parse(concat('{\"label\":\"', tenant.displayName, '\",\"description\":\"', tenant.tenantId, '\",\"value\":\"', toLower(tenant.tenantId), '\"}')) )]",
                            "required": true
                        }
                    },
                    {
                        "name": "esMgmtSub",
                        "type": "Microsoft.Common.DropDown",
                        "label": "Management Subscription",
                        "toolTip": "",
                        "multiselect": false,
                        "selectAll": true,
                        "filter": true,
                        "filterPlaceholder": "Filter items ...",
                        "multiLine": true,
                        "visible": true,
                        "constraints": {
                            "allowedValues": "[map(steps('esPlatformManagement').mgmtSubApi.value, (sub) => parse(concat('{\"label\":\"', sub.displayName, '\",\"description\":\"', sub.subscriptionId, '\",\"value\":\"', toLower(sub.subscriptionId), '\"}')) )]",
                            "required": true
                        }
                    },   			
                    {
                        "name": "monitoring",
                        "type": "Microsoft.Common.TextBlock",
                        "visible": "[equals(steps('esPlatformManagement').esLogAnalytics, 'Yes')]",
                        "options": {
                            "text": "Select which Azure Monitor solutions you will enable for your Log Analytics workspace",
                            "link": {
                                "label": "Learn more",
                                "uri": "https://docs.microsoft.com/azure/azure-monitor/insights/solutions"
                            }
                        }
                    },
                    {
                        "name": "esAgentSolution",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Deploy Agent Health solution",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected when also adding a subscription for management, ARM will deploy resources and enable them for continous compliance",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
						"visible": "[equals(steps('esPlatformManagement').esLogAnalytics, 'Yes')]"
                    },
                    {
                        "name": "esChangeTracking",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Deploy Change Tracking solution",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected when also adding a subscription for management, ARM will deploy resources and enable them for continous compliance",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
						"visible": "[equals(steps('esPlatformManagement').esLogAnalytics, 'Yes')]"
                    },
                    {
                        "name": "esUpdateMgmt",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Deploy Update Management solution",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected when also adding a subscription for management, ARM will deploy resources and enable them for continous compliance",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
						"visible": "[equals(steps('esPlatformManagement').esLogAnalytics, 'Yes')]"
                    },
                    {
                        "name": "esActivityLog",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Deploy Activity Log solution",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected when also adding a subscription for management, ARM will deploy resources and enable them for continous compliance",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
						"visible": "[equals(steps('esPlatformManagement').esLogAnalytics, 'Yes')]"
                    },
                    {
                        "name": "esVmInsights",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Deploy VM Insights solution",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected when also adding a subscription for management, ARM will deploy resources and enable them for continous compliance",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
						"visible": "[equals(steps('esPlatformManagement').esLogAnalytics, 'Yes')]"
                    },
                    {
                        "name": "esAntiMalware",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Deploy Antimalware solution",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected when also adding a subscription for management, ARM will deploy resources and enable them for continous compliance",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
						"visible": "[equals(steps('esPlatformManagement').esLogAnalytics, 'Yes')]"
                    },
                    {
                        "name": "esServiceMap",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Deploy Service Map solution",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected when also adding a subscription for management, ARM will deploy resources and enable them for continous compliance",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
						"visible": "[equals(steps('esPlatformManagement').esLogAnalytics, 'Yes')]"
                    },
                    {
                        "name": "esSqlAssessment",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Deploy SQL Assessment solution",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected when also adding a subscription for management, ARM will deploy resources and enable them for continous compliance",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
						"visible": "[equals(steps('esPlatformManagement').esLogAnalytics, 'Yes')]"
                    },
                    {
                        "name": "textBlock0",
                        "type": "Microsoft.Common.TextBlock",
                        "visible": "[equals(steps('esPlatformManagement').esLogAnalytics, 'Yes')]",
                        "options": {
                            "text": "Select which Azure Security solutions you will enable.",
                            "link": {
                                "label": "Learn more",
                                "uri": "https://docs.microsoft.com/azure/security/fundamentals/overview"
                            }
                        }
                    },					
                    {
                        "name": "esAsc",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Deploy Azure Security Center and enable security monitoring for your platform and resources",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected when also adding a subscription for management, ARM will deploy resources and enable them for continous compliance",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
						"visible": "[equals(steps('esPlatformManagement').esLogAnalytics, 'Yes')]"
                    },
					{
						"name": "esAscVms",
						"type": "Microsoft.Common.OptionsGroup",
						"label": "Enable Azure Defender for servers",
						"defaultValue": "Yes (recommended)",
						"toolTip": "If 'Yes' is selected, Azure Defender will be enabled for all servers.",
						"visible": "[equals(steps('esPlatformManagement').esAsc, 'Yes')]",
						"constraints": {
							"allowedValues": [
								{
									"label": "Yes (recommended)",
									"value": "Standard"
								},
								{
									"label": "No, Azure Defender Off",
									"value": "Free"
								}
							]
						}
					},
					{
						"name": "esAscApps",
						"type": "Microsoft.Common.OptionsGroup",
						"label": "Enable Azure Defender for AppServices",
						"defaultValue": "Yes (recommended)",
						"toolTip": "If 'Yes' is selected, Azure Defender will be enabled for AppServices.",
						"visible": "[equals(steps('esPlatformManagement').esAsc, 'Yes')]",
						"constraints": {
							"allowedValues": [
								{
									"label": "Yes (recommended)",
									"value": "Standard"
								},
								{
									"label": "No, Azure Defender Off",
									"value": "Free"
								}
							]
						}
					},
					{
						"name": "esAscStorage",
						"type": "Microsoft.Common.OptionsGroup",
						"label": "Enable Azure Defender for Storage",
						"defaultValue": "Yes (recommended)",
						"toolTip": "If 'Yes' is selected, Azure Defender will be enabled for Storage.",
						"visible": "[equals(steps('esPlatformManagement').esAsc, 'Yes')]",
						"constraints": {
							"allowedValues": [
								{
									"label": "Yes (recommended)",
									"value": "Standard"
								},
								{
									"label": "No, Azure Defender Off",
									"value": "Free"
								}
							]
						}
					},
					{
						"name": "esAscSql",
						"type": "Microsoft.Common.OptionsGroup",
						"label": "Enable Azure Defender for SQL",
						"defaultValue": "Yes (recommended)",
						"toolTip": "If 'Yes' is selected, Azure Defender will be enabled for SQL.",
						"visible": "[equals(steps('esPlatformManagement').esAsc, 'Yes')]",
						"constraints": {
							"allowedValues": [
								{
									"label": "Yes (recommended)",
									"value": "Standard"
								},
								{
									"label": "No, Azure Defender Off",
									"value": "Free"
								}
							]
						}
					},
					{
						"name": "esAscKeyVault",
						"type": "Microsoft.Common.OptionsGroup",
						"label": "Enable Azure Defender for Key Vault",
						"defaultValue": "Yes (recommended)",
						"toolTip": "If 'Yes' is selected, Azure Defender will be enabled for Key Vault.",
						"visible": "[equals(steps('esPlatformManagement').esAsc, 'Yes')]",
						"constraints": {
							"allowedValues": [
								{
									"label": "Yes (recommended)",
									"value": "Standard"
								},
								{
									"label": "No, Azure Defender Off",
									"value": "Free"
								}
							]
						}
					},
					{
						"name": "esAscArm",
						"type": "Microsoft.Common.OptionsGroup",
						"label": "Enable Azure Defender for Azure Resource Manager",
						"defaultValue": "Yes (recommended)",
						"toolTip": "If 'Yes' is selected, Azure Defender will be enabled for Resource Manager.",
						"visible": "[equals(steps('esPlatformManagement').esAsc, 'Yes')]",
						"constraints": {
							"allowedValues": [
								{
									"label": "Yes (recommended)",
									"value": "Standard"
								},
								{
									"label": "No, Azure Defender Off",
									"value": "Free"
								}
							]
						}
					},
					{
						"name": "esAscDns",
						"type": "Microsoft.Common.OptionsGroup",
						"label": "Enable Azure Defender for DNS",
						"defaultValue": "Yes (recommended)",
						"toolTip": "If 'Yes' is selected, Azure Defender will be enabled for DNS.",
						"visible": "[equals(steps('esPlatformManagement').esAsc, 'Yes')]",
						"constraints": {
							"allowedValues": [
								{
									"label": "Yes (recommended)",
									"value": "Standard"
								},
								{
									"label": "No, Azure Defender Off",
									"value": "Free"
								}
							]
						}
					},
					{
						"name": "esAscKubernetes",
						"type": "Microsoft.Common.OptionsGroup",
						"label": "Enable Azure Defender for Kubernetes",
						"defaultValue": "Yes (recommended)",
						"toolTip": "If 'Yes' is selected, Azure Defender will be enabled for Kubernetes.",
						"visible": "[equals(steps('esPlatformManagement').esAsc, 'Yes')]",
						"constraints": {
							"allowedValues": [
								{
									"label": "Yes (recommended)",
									"value": "Standard"
								},
								{
									"label": "No, Azure Defender Off",
									"value": "Free"
								}
							]
						}
					},
					{
						"name": "esAscRegistries",
						"type": "Microsoft.Common.OptionsGroup",
						"label": "Enable Azure Defender for Container registries",
						"defaultValue": "Yes (recommended)",
						"toolTip": "If 'Yes' is selected, Azure Defender will be enabled for Container registries.",
						"visible": "[equals(steps('esPlatformManagement').esAsc, 'Yes')]",
						"constraints": {
							"allowedValues": [
								{
									"label": "Yes (recommended)",
									"value": "Standard"
								},
								{
									"label": "No, Azure Defender Off",
									"value": "Free"
								}
							]
						}
					},                                     
                    {
                        "name": "esSecuritySolution",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Deploy Azure Sentinel",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected when also adding a subscription for management, ARM will deploy resources and enable them for continous compliance",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
						"visible": "[equals(steps('esPlatformManagement').esLogAnalytics, 'Yes')]"
                    },
                    {
                        "name": "esAkv",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Deploy Azure Key Vault.",
                        "defaultValue": "Yes",
                        "toolTip": "If 'Yes' is selected, an Azure Key Vault will be deployed",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
                        "visible": true
                    },
                    {
                        "name": "esSta",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Deploy a Storage account for diagnostics.",
                        "defaultValue": "Yes",
                        "toolTip": "If 'Yes' is selected, a Storage account will be deployed",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
                        "visible": true
                    },
                    {
                        "name": "esActivityLogSta",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Enable Long Term retention of Logs to Azure Storage.",
                        "defaultValue": "Yes",
                        "toolTip": "If 'Yes' is selected, Long term retention of Azure Activity Logs to Azure Storage will be enabled",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
                        "visible": "[equals(steps('esPlatformManagement').esSta, 'Yes')]"
                    },
                    {
                        "name": "esRsv",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Deploy a Recovery Services Vault.",
                        "defaultValue": "Yes",
                        "toolTip": "If 'Yes' is selected, a Recovery Services Vault will be deployed",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
                        "visible": true
                    }			
                ]
            },
            {
                "name": "esPlatformConnectivity",
                "label": "Network Connectivity (Virtual WAN)",
                "subLabel": {
                    "preValidation": "",
                    "postValidation": ""
                },
                "bladeTitle": "lzGs",
                "elements": [
                    {
                        "name": "infoBox1",
                        "type": "Microsoft.Common.InfoBox",
                        "visible": true,
                        "options": {
                            "icon": "Info",
                            "text": "To enable Virtual WAN connectivity, you must allocate a connectivity Subscription. Please note, this Subscription will be moved to the connectivity Management Group, and ARM will deploy a Virtual WAN with the first Virtual Hub and requisite settings. We recommend using a new Subscription with no existing resources.",
                            "uri": "https://github.com/Azure/Enterprise-Scale/blob/main/docs/reference/Readme.md"
                        }
                    },
                    {
                        "name": "esVwan",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Deploy Virtual WAN",
                        "defaultValue": "Yes",
                        "toolTip": "If 'Yes' is selected when also adding a subscription for connectivity, ARM will deploy Virtual WAN",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
                        "visible": true
                    },
                    {
                        "name": "ConnSubApi",
                        "type": "Microsoft.Solutions.ArmApiControl",
                        "request": {
                            "method": "GET",
                            "path": "subscriptions?api-version=2020-01-01"
                        }
                    },
                    {
                        "name": "esConnSub",
                        "type": "Microsoft.Common.DropDown",
                        "label": "Network Connectivity subscription (required)",
                        "toolTip": "",
                        "multiselect": false,
                        "selectAll": true,
                        "filter": true,
                        "filterPlaceholder": "Filter items ...",
                        "multiLine": true,
                        "visible": "[equals(steps('esPlatformConnectivity').esVwan, 'Yes')]",
                        "constraints": {
                            "allowedValues": "[map(steps('esPlatformConnectivity').ConnSubApi.value, (sub) => parse(concat('{\"label\":\"', sub.displayName, '\",\"description\":\"', sub.subscriptionId, '\",\"value\":\"', toLower(sub.subscriptionId), '\"}')) )]",
                            "required": true
                        }
                    },                    
                    {
                        "name": "esAddress",
                        "type": "Microsoft.Common.TextBox",
                        "label": "Address space (required for Virtual Hub)",
                        "toolTip": "Provide address prefix in CIDR notation (e.g 192.168.0.0/16)",
                        "defaultValue": "192.168.0.0/16",
                        "visible": "[equals(steps('esPlatformConnectivity').esVwan, 'Yes')]",
                        "constraints": {
                            "required": true,
                            "validationMessage": "The virtual hubs network's address space, specified as one address prefixes in CIDR notation (e.g. 192.168.0.0/16)"
                        }
                    },
                    {
                        "name": "esLocationsApi",
                        "type": "Microsoft.Solutions.ArmApiControl",
                        "request": {
                            "method": "GET",
                            "path": "locations?api-version=2019-11-01"
                        }
                    },
                    {
                        "name": "esNwLocation",
                        "type": "Microsoft.Common.DropDown",
                        "label": "Region for the first virtual hub",
                        "defaultValue": "Australai East",
                        "toolTip": "Select the target region for you connectivity deployment (requires you to provide a subscriptionId for connectivity)",
                        "constraints": {
                            "allowedValues": "[map(steps('esPlatformConnectivity').esLocationsApi.value, (item) => parse(concat('{\"label\":\"', item.displayName, '\",\"value\":\"', item.name, '\"}')))]",
                            "required": true
                        },
                        "visible": "[equals(steps('esPlatformConnectivity').esVwan, 'Yes')]"
                    },
                    {
                        "name": "esVpnGw",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Deploy VPN Gateway",
                        "defaultValue": "No",
                        "visible": "[equals(steps('esPlatformConnectivity').esVwan, 'Yes')]",
                        "toolTip": "If 'Yes' is selected when also adding a subscription for connectivity, ARM will deploy VPN gateway",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        }
                    },
                    {
                        "name": "esErGw",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Deploy ExpressRoute Gateway",
                        "defaultValue": "No",
                        "visible": "[equals(steps('esPlatformConnectivity').esVwan, 'Yes')]",
                        "toolTip": "If 'Yes' is selected when also adding a subscription for connectivity, ARM will deploy Express Route gateway",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        }
                    },
                    {
                        "name": "esAzFw",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Deploy Azure Firewall",
                        "defaultValue": "Yes",
                        "visible": "[equals(steps('esPlatformConnectivity').esVwan, 'Yes')]",
                        "toolTip": "If 'Yes' is selected when also adding a subscription for connectivity, ARM will deploy Azure Firewall",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        }
                    }
                ]
            },
            {
                "name": "esPlatformIdentity",
                "label": "Identity",
                "subLabel": {
                    "preValidation": "",
                    "postValidation": ""
                },
                "bladeTitle": "lzGs",
                "elements": [
                    {
                        "name": "infoBox1",
                        "type": "Microsoft.Common.InfoBox",
                        "visible": true,
                        "options": {
                            "icon": "Info",
                            "text": "To enable identity (AuthN/AuthZ) for workloads in landing zones, you must allocate an identity Subscription that is dedicated to host your Active Directory domain controllers. Please note, this Subscription will be moved to the identity Management Group, and ARM will assign the selected policies. We recommend using a new Subscription with no existing resources.",
                            "uri": "https://github.com/Azure/Enterprise-Scale/blob/main/docs/reference/Readme.md"
                        }
                    },
                    {
                        "name": "esIdentity",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Enable identity subscription",
                        "defaultValue": "No",
                        "toolTip": "If 'Yes' is selected when also adding a subscription for connectivity, ARM will move selected subscription into identity management group",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
                        "visible": true
                    },
                    {
                        "name": "esIdamSubsApi",
                        "type": "Microsoft.Solutions.ArmApiControl",
                        "request": {
                            "method": "GET",
                            "path": "subscriptions?api-version=2020-01-01"
                        }
                    },                  
                    {
                        "name": "esIdamSub",
                        "type": "Microsoft.Common.DropDown",
                        "label": "Identity subscription",
                        "toolTip": "",
                        "multiselect": false,
                        "selectAll": true,
                        "filter": true,
                        "filterPlaceholder": "Filter items ...",
                        "multiLine": true,
                        "visible": "[equals(steps('esPlatformIdentity').esIdentity, 'Yes')]",
                        "constraints": {
                            "allowedValues": "[map(steps('esPlatformIdentity').esIdamSubsApi.value, (sub) => parse(concat('{\"label\":\"', sub.displayName, '\",\"description\":\"', sub.subscriptionId, '\",\"value\":\"', toLower(sub.subscriptionId), '\"}')) )]",
                            "required": true
                        }
                    },
                    {
                        "name": "identitypolicies",
                        "type": "Microsoft.Common.TextBlock",
                        "visible": "[equals(steps('esPlatformIdentity').esIdentity, 'Yes')]",
                        "options": {
                            "text": "Select which of the the recommended policies you will assign to your identity management group.",
                            "link": {
                                "label": "Learn more",
                                "uri": "https://docs.microsoft.com/en-us/azure/cloud-adoption-framework/ready/enterprise-scale/design-principles#policy-driven-governance"
                            }
                        }
                    },
                    {
                        "name": "esIdDenyRdp",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Prevent inbound RDP from internet",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected, Azure Policy will be assigned and prevent inbound RDP from internet",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
                        "visible": "[equals(steps('esPlatformIdentity').esIdentity, 'Yes')]"
                    },
                    {
                        "name": "esIdDenySubnetNsg",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Ensure subnets are associated with NSG",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected, Azure Policy will be assigned to ensure NSGs must be associated with subnets being created",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
                        "visible": "[equals(steps('esPlatformIdentity').esIdentity, 'Yes')]"
                    },
                    {
                        "name": "esIdDenyPublicIp",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Prevent usage of public IP",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected, Azure Policy will be assigned to ensure public IP resources cannot be created",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
                        "visible": "[equals(steps('esPlatformIdentity').esIdentity, 'Yes')]"
                    },
                    {
                        "name": "esIdAzBackup",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Ensure Azure VMs (Windows & Linux) are enabled for Azure Backup",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected, Azure Policy will be assigned and enable Azure Backup on all VMs in the landing zones.",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
                        "visible": "[equals(steps('esPlatformIdentity').esIdentity, 'Yes')]"
                    }
                ]
            },                     
            {
                "name": "lzGoalState",
                "label": "Landing zone configuration",
                "subLabel": {
                    "preValidation": "",
                    "postValidation": ""
                },
                "bladeTitle": "lzGs",
                "elements": [
                    {
                        "name": "infoBox1",
                        "type": "Microsoft.Common.InfoBox",
                        "visible": true,
                        "options": {
                            "icon": "Info",
                            "text": "You can optionally provide subscriptions for your first landing zones for both 'online' and 'corp' and assign recommended policies that will ensure workloads will be secure, monitored, and protected according to best practices.",
                            "uri": "https://github.com/Azure/Enterprise-Scale/blob/main/docs/Deploy/ES-schema.md"
                        }
                    },
                    {
                        "name": "onlineText",
                        "type": "Microsoft.Common.TextBlock",
                        "visible": "[equals(steps('esPlatformManagement').esLogAnalytics, 'Yes')]",
                        "options": {
                            "text": "Select the subscriptions you want to move to online management group.",
                            "link": {
                                "label": "Learn more",
                                "uri": "https://docs.microsoft.com/azure/azure-monitor/insights/solutions"
                            }
                        }
                    },
                    {
                        "name": "lzOnlineSubsApi",
                        "type": "Microsoft.Solutions.ArmApiControl",
                        "request": {
                            "method": "GET",
                            "path": "subscriptions?api-version=2020-01-01"
                        }
                    },                  
                    {
                        "name": "esOnlineLzSub",
                        "type": "Microsoft.Common.DropDown",
                        "label": "Online landing zone subscriptions (optional)",
                        "toolTip": "",
                        "multiselect": true,
                        "selectAll": true,
                        "filter": true,
                        "filterPlaceholder": "Filter items ...",
                        "multiLine": true,
                        "visible": true,
                        "constraints": {
                            "allowedValues": "[map(steps('lzGoalState').lzOnlineSubsApi.value, (sub) => parse(concat('{\"label\":\"', sub.displayName, '\",\"description\":\"', sub.subscriptionId, '\",\"value\":\"', toLower(sub.subscriptionId), '\"}')) )]",
                            "required": false
                        }
                    },
                    {
                        "name": "corpText",
                        "type": "Microsoft.Common.TextBlock",
                        "visible": "[equals(steps('esPlatformManagement').esLogAnalytics, 'Yes')]",
                        "options": {
                            "text": "Select the subscriptions you want to move to corp management group.",
                            "link": {
                                "label": "Learn more",
                                "uri": "https://docs.microsoft.com/azure/azure-monitor/insights/solutions"
                            }
                        }
                    },
                    {
                        "name": "lzCorpSubsApi",
                        "type": "Microsoft.Solutions.ArmApiControl",
                        "request": {
                            "method": "GET",
                            "path": "subscriptions?api-version=2020-01-01"
                        }
                    },
                    {
                        "name": "esCorpLzSub",
                        "type": "Microsoft.Common.DropDown",
                        "label": "Corp landing zone subscriptions (optional)",
                        "toolTip": "",
                        "multiselect": true,
                        "selectAll": true,
                        "filter": true,
                        "filterPlaceholder": "Filter items ...",
                        "multiLine": true,
                        "visible": true,
                        "constraints": {
                            "allowedValues": "[map(steps('lzGoalState').lzCorpSubsApi.value, (sub) => parse(concat('{\"label\":\"', sub.displayName, '\",\"description\":\"', sub.subscriptionId, '\",\"value\":\"', toLower(sub.subscriptionId), '\"}')) )]",
                            "required": false
                        }
                    },
                    {
                        "name": "azMonText",
                        "type": "Microsoft.Common.TextBlock",
                        "visible": true,
                        "options": {
                            "text": "Select which of the the recommended policies you will assign to your landing zones.",
                            "link": {
                                "label": "Learn more",
                                "uri": "https://docs.microsoft.com/en-us/azure/cloud-adoption-framework/ready/enterprise-scale/design-principles#policy-driven-governance"
                            }
                        }
                    },
                    {
                        "name": "esVmMonitoring",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Ensure Azure VMs (Windows & Linux) are being monitored",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected when also adding a subscription for management, ARM will deploy resources and enable them for continous compliance",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
						"visible": "[equals(steps('esPlatformManagement').esLogAnalytics, 'Yes')]"
                    },
                    {
                        "name": "esVmssMonitoring",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Ensure Azure VMSS (Windows & Linux) are being monitored",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected when also adding a subscription for management, ARM will deploy resources and enable them for continous compliance",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
						"visible": "[equals(steps('esPlatformManagement').esLogAnalytics, 'Yes')]"
                    },
                    {
                        "name": "esArcVmMonitoring",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Ensure Azure Arc VMs (Windows & Linux) are being monitored",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected when also adding a subscription for management, ARM will deploy resources and enable them for continous compliance",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
						"visible": "[equals(steps('esPlatformManagement').esLogAnalytics, 'Yes')]"
                    },
                    {
                        "name": "esAksPolicy",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Enable Kubernetes (AKS) for Azure Policy",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected when also adding a subscription for management, ARM will deploy resources and enable them for continous compliance",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
						"visible": true
                    },
                    {
                        "name": "esAksPriv",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Prevent privileged containers in Kubernetes clusters",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected, policy will be assigned to prevent privileged containers in AKS",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
						"visible": true
                    },
                    {
                        "name": "esAksNoPriv",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Prevent privileged escalation in Kubernetes clusters",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected, policy will be assigned to prevent privileged escalations in AKS",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
						"visible": true
                    },                    
                    {
                        "name": "esAksIngress",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Ensure HTTPS ingress is enforced in Kubernetes clusters",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected, HTTPS ingress will be required in AKS",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
						"visible": true
                    },                                                       
                    {
                        "name": "esAzBackup",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Ensure Azure VMs (Windows & Linux) are enabled for Azure Backup",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected, Azure Policy will be assigned and enable Azure Backup on all VMs in the landing zones.",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
                        "visible": true
                    },
                    {
                        "name": "esDenyRdp",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Prevent inbound RDP from internet",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected, Azure Policy will be assigned and prevent inbound RDP from internet",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
                        "visible": true
                    },
                    {
                        "name": "esNsg",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Ensure subnets are associated with NSG",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected, Azure Policy will be assigned to ensure NSGs must be associated with subnets being created",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
                        "visible": true
                    },
                    {
                        "name": "esIpForwarding",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Prevent IP forwarding",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected, Azure Policy will be assigned and prevent IP forwarding",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
                        "visible": true
                    },
                    {
                        "name": "esSqlEncryption",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Ensure Azure SQL is enabled with transparent data encryption",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected when also adding a subscription for management, ARM will deploy resources and enable them for continous compliance",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
                        "visible": true
                    },
                    {
                        "name": "esSqlAudit",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Ensure auditing is enabled on Azure SQL",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected, Azure Policy will be assigned to ensure auditing is enabled on Azure SQLs",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
                        "visible": true
                    },
                    {
                        "name": "esHttpsStorage",
                        "type": "Microsoft.Common.OptionsGroup",
                        "label": "Ensure secure connections (HTTPS) to storage accounts",
                        "defaultValue": "Yes (recommended)",
                        "toolTip": "If 'Yes' is selected, Azure Policy will be assigned to ensure storage can only be accessed using HTTPS",
                        "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes (recommended)",
                                    "value": "Yes"
                                },
                                {
                                    "label": "No",
                                    "value": "No"
                                }
                            ]
                        },
                        "visible": true
                    }
                ]
            }
        ],
        "outputs": {
            "companyPrefix": "[steps('esNaming').esComIdentifier]",
            "locationPrefix": "[steps('esNaming').esLocIdentifier]",
            "environmentPrefix": "[steps('esNaming').esSubIdentifier]",
            "argPrefix": "[steps('esNaming').esArgIdentifier]",
            "omsPrefix": "[steps('esNaming').esOmsIdentifier]",
            "aaaPrefix": "[steps('esNaming').esAaaIdentifier]",
            "staPrefix": "[steps('esNaming').esStaIdentifier]",
            "akvPrefix": "[steps('esNaming').esAkvIdentifier]",
            "rsvPrefix": "[steps('esNaming').esRsvIdentifier]",
            "vngPrefix": "[steps('esNaming').esVngIdentifier]",
            "azFwPrefix": "[steps('esNaming').esAfwIdentifier]",
            "vWanPrefix": "[steps('esNaming').esWanIdentifier]",
            "vHubPrefix": "[steps('esNaming').esHubIdentifier]",
            "subscriptionTag": "[steps('esNaming').esSubscriptionTag]",
            "ownerTag": "[steps('esNaming').esOwnerTag]",
            "costCenterTag": "[steps('esNaming').esCostCenterTag]",
            
            "tenantId": "[steps('esPlatformManagement').esAzureAdTenant]",
            "managementSubscriptionId": "[steps('esPlatformManagement').esMgmtSub]",
            "enableLogAnalytics": "[steps('esPlatformManagement').esLogAnalytics]",
            "retentionInDays": "[string(steps('esPlatformManagement').esLogRetention)]",
            "enableAsc": "[steps('esPlatformManagement').esAsc]",
            "enableAscForServers": "[steps('esPlatformManagement').esAscVms]",
            "enableAscForAppServices": "[steps('esPlatformManagement').esAscApps]",
            "enableAscForStorage": "[steps('esPlatformManagement').esAscStorage]",
            "enableAscForSql": "[steps('esPlatformManagement').esAscSql]",
            "enableAscForKeyVault": "[steps('esPlatformManagement').esAscKeyVault]",
            "enableAscForArm": "[steps('esPlatformManagement').esAscArm]",
            "enableAscForDns": "[steps('esPlatformManagement').esAscDns]",
            "enableAscForKubernetes": "[steps('esPlatformManagement').esAscKubernetes]",
            "enableAscForRegistries": "[steps('esPlatformManagement').esAscRegistries]",
            "enableSecuritySolution": "[steps('esPlatformManagement').esSecuritySolution]",
            "enableAgentHealth": "[steps('esPlatformManagement').esAgentSolution]",
            "enableChangeTracking": "[steps('esPlatformManagement').esChangeTracking]",
            "enableUpdateMgmt": "[steps('esPlatformManagement').esUpdateMgmt]",
            "enableActivityLog": "[steps('esPlatformManagement').esActivityLog]",
            "enableVmInsights": "[steps('esPlatformManagement').esVmInsights]",
            "enableAntiMalware": "[steps('esPlatformManagement').esAntiMalware]",
            "enableServiceMap": "[steps('esPlatformManagement').esServiceMap]",
            "enableSqlAssessment": "[steps('esPlatformManagement').esSqlAssessment]",
            "enableAkv": "[steps('esPlatformManagement').esAkv]",
            "enableStorage": "[steps('esPlatformManagement').esSta]",
            "enableLtrStorage": "[steps('esPlatformManagement').esActivityLogSta]",
            "enableRsv": "[steps('esPlatformManagement').esRsv]",

            "connectivitySubscriptionId": "[if(not(equals(steps('esPlatformConnectivity').esConnSub, steps('esPlatformManagement').esMgmtSub)), steps('esPlatformConnectivity').esConnSub, '')]",
            "enableErGw": "[steps('esPlatformConnectivity').esErGw]",
            "enableVpnGw": "[steps('esPlatformConnectivity').esVpnGw]",
            "enableVwan": "[steps('esPlatformConnectivity').esVwan]",
            "enableAzFw": "[steps('esPlatformConnectivity').esAzFw]",
            "addressPrefix": "[steps('esPlatformConnectivity').esAddress]",
            "location": "[steps('esPlatformConnectivity').esNwLocation]",
            
            "identitySubscriptionId": "[if(or(not(equals(steps('esPlatformIdentity').esIdamSub, steps('esPlatformManagement').esMgmtSub)), not(equals(steps('esPlatformIdentity').esIdamSub, steps('esPlatformConnectivity').esConnSub))), steps('esPlatformIdentity').esIdamSub, '')]",
            "denyRdpForIdentity": "[steps('esPlatformIdentity').esIdDenyRdp]",
            "denySubnetWithoutNsgForIdentity": "[steps('esPlatformIdentity').esIdDenySubnetNsg]",
            "denyPipForIdentity": "[steps('esPlatformIdentity').esIdDenyPublicIp]",
            "enableVmBackupForIdentity": "[steps('esPlatformIdentity').esIdAzBackup]",

            "onlineLzSubscriptionId": "[if(or(not(contains(steps('lzGoalState').esOnlineLzSub, steps('esPlatformManagement').esMgmtSub)), not(contains(steps('lzGoalState').esOnlineLzSub, steps('esPlatformConnectivity').esConnSub))), steps('lzGoalState').esOnlineLzSub, '')]",
            "corpLzSubscriptionId": "[if(or(not(contains(steps('lzGoalState').esCorpLzSub, steps('esPlatformManagement').esMgmtSub)), not(contains(steps('lzGoalState').esCorpLzSub, steps('esPlatformConnectivity').esConnSub))), steps('lzGoalState').esCorpLzSub, '')]",
            "enableSqlAudit": "[steps('lzGoalState').esSqlAudit]",
            "enableSqlEncryption": "[steps('lzGoalState').esSqlEncryption]",
            "enableVmBackup": "[steps('lzGoalState').esAzBackup]",
            "enableAksPolicy": "[steps('lzGoalState').esAksPolicy]",
            "denyAksPrivileged": "[steps('lzGoalState').esAksPriv]",
            "denyAksPrivilegedEscalation": "[steps('lzGoalState').esAksNoPriv]",
            "denyHttpIngressForAks": "[steps('lzGoalState').esAksIngress]",
            "denyRdp": "[steps('lzGoalState').esDenyRdp]",
            "enableStorageHttps": "[steps('lzGoalState').esHttpsStorage]",
            "denyIpForwarding": "[steps('lzGoalState').esIpForwarding]",
            "denySubnetWithoutNsg": "[steps('lzGoalState').esNsg]",
            "enableVmMonitoring": "[steps('lzGoalState').esVmMonitoring]",
            "enableVmssMonitoring": "[steps('lzGoalState').esVmssMonitoring]",
            "enableArcMonitoring": "[steps('lzGoalState').esArcVmMonitoring]"
        }
    }
}